syntax = "proto3";

package authzen.v1;

import "google/api/annotations.proto";
import "google/api/field_behavior.proto";
import "google/protobuf/struct.proto";
import "protoc-gen-openapiv2/options/annotations.proto";
import "validate/validate.proto";

service AuthZenService {
  rpc Evaluation(EvaluationRequest) returns (EvaluationResponse) {
    option (google.api.http) = {
      post: "/stores/{store_id}/access/v1/evaluation"
      body: "*"
    };

    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Evaluate whether a subject can perform an action on a resource"
      tags: ["AuthZen"]
      operation_id: "Evaluation"
      description:
        "The Evaluation API determines whether a subject is authorized to perform an action on a resource. "
        "This endpoint implements the AuthZEN Access Evaluation API specification.\n\n"
        "## Request Structure\n"
        "The request requires three components:\n"
        "- **subject**: The entity requesting access (e.g., a user or service)\n"
        "- **action**: The operation being performed (maps to a relation in the authorization model)\n"
        "- **resource**: The object being accessed\n\n"
        "Each component has a `type` and `id` field, and may include optional `properties` for ABAC (Attribute-Based Access Control) conditions.\n\n"
        "## Response\n"
        "The response contains a `decision` field (boolean) indicating whether access is permitted, "
        "and an optional `context` object with additional information such as the evaluation ID or error details.\n\n"
        "## ABAC Support\n"
        "Properties on subject, action, and resource are automatically merged into the evaluation context with prefixes:\n"
        "- Subject properties: `subject_<property_name>`\n"
        "- Resource properties: `resource_<property_name>`\n"
        "- Action properties: `action_<property_name>`\n\n"
        "These merged properties can be used in conditions defined in your authorization model.\n\n"
        "## Examples\n"
        "### Basic authorization check\n"
        "Check if user Anne can read a document:\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"anne\"},\n"
        "  \"action\": {\"name\": \"can_read\"},\n"
        "  \"resource\": {\"type\": \"document\", \"id\": \"roadmap\"}\n"
        "}\n"
        "```\n"
        "Response when authorized:\n"
        "```json\n"
        "{\n"
        "  \"decision\": true\n"
        "}\n"
        "```\n"
        "### Using properties for ABAC\n"
        "Check access with subject and resource attributes:\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\n"
        "    \"type\": \"user\",\n"
        "    \"id\": \"anne\",\n"
        "    \"properties\": {\"department\": \"engineering\", \"clearance_level\": 3}\n"
        "  },\n"
        "  \"action\": {\"name\": \"can_read\"},\n"
        "  \"resource\": {\n"
        "    \"type\": \"document\",\n"
        "    \"id\": \"secret-project\",\n"
        "    \"properties\": {\"classification\": \"confidential\", \"required_clearance\": 2}\n"
        "  }\n"
        "}\n"
        "```\n"
        "### Using request context\n"
        "Provide additional context for time-based or environmental conditions:\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"bob\"},\n"
        "  \"action\": {\"name\": \"can_access\"},\n"
        "  \"resource\": {\"type\": \"system\", \"id\": \"production\"},\n"
        "  \"context\": {\n"
        "    \"current_time\": \"2024-01-15T14:30:00Z\",\n"
        "    \"ip_address\": \"192.168.1.100\",\n"
        "    \"is_vpn_connected\": true\n"
        "  }\n"
        "}\n"
        "```\n"
        "### Specifying authorization model\n"
        "Pin the evaluation to a specific authorization model version using the `Openfga-Authorization-Model-Id` header:\n"
        "```\n"
        "POST /stores/{store_id}/access/v1/evaluation\n"
        "Openfga-Authorization-Model-Id: 01G50QVV17PECNVAHX1GG4Y5NC\n"
        "\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"anne\"},\n"
        "  \"action\": {\"name\": \"can_write\"},\n"
        "  \"resource\": {\"type\": \"document\", \"id\": \"budget-2024\"}\n"
        "}\n"
        "```\n"
    };
  }

  rpc Evaluations(EvaluationsRequest) returns (EvaluationsResponse) {
    option (google.api.http) = {
      post: "/stores/{store_id}/access/v1/evaluations"
      body: "*"
    };

    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Check whether one or more users are authorized to access resources"
      tags: ["AuthZen"]
      operation_id: "Evaluations"
      description:
        "The Evaluations API allows batch authorization checks in a single request. "
        "It supports request-level defaults for subject, action, resource, and context that can be overridden per evaluation item.\n\n"
        "## Evaluation Semantics\n"
        "The `options.evaluations_semantic` field controls how evaluations are processed:\n"
        "- `execute_all` (default): Execute all evaluations and return all results\n"
        "- `deny_on_first_deny`: Stop processing on first deny decision\n"
        "- `permit_on_first_permit`: Stop processing on first permit decision\n\n"
        "## Examples\n"
        "### Basic batch evaluation\n"
        "Check if a user can perform multiple actions on a document:\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"anne\"},\n"
        "  \"resource\": {\"type\": \"document\", \"id\": \"roadmap\"},\n"
        "  \"evaluations\": [\n"
        "    {\"action\": {\"name\": \"can_read\"}},\n"
        "    {\"action\": {\"name\": \"can_write\"}},\n"
        "    {\"action\": {\"name\": \"can_delete\"}}\n"
        "  ]\n"
        "}\n"
        "```\n"
        "### Using evaluation semantics\n"
        "Stop on first permitted action (useful for finding any valid permission):\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"anne\"},\n"
        "  \"resource\": {\"type\": \"document\", \"id\": \"roadmap\"},\n"
        "  \"evaluations\": [\n"
        "    {\"action\": {\"name\": \"can_read\"}},\n"
        "    {\"action\": {\"name\": \"can_write\"}}\n"
        "  ],\n"
        "  \"options\": {\n"
        "    \"evaluations_semantic\": \"permit_on_first_permit\"\n"
        "  }\n"
        "}\n"
        "```\n"
        "### Overriding defaults per evaluation\n"
        "Check permissions across multiple resources:\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"anne\"},\n"
        "  \"action\": {\"name\": \"can_read\"},\n"
        "  \"evaluations\": [\n"
        "    {\"resource\": {\"type\": \"document\", \"id\": \"doc1\"}},\n"
        "    {\"resource\": {\"type\": \"document\", \"id\": \"doc2\"}},\n"
        "    {\"resource\": {\"type\": \"folder\", \"id\": \"folder1\"}}\n"
        "  ]\n"
        "}\n"
        "```\n"
    };
  }

  // SubjectSearch returns subjects that have access to the specified resource
  rpc SubjectSearch(SubjectSearchRequest) returns (SubjectSearchResponse) {
    option (google.api.http) = {
      post: "/stores/{store_id}/access/v1/search/subject"
      body: "*"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Search for subjects with access to a resource"
      tags: ["AuthZen"]
      operation_id: "SubjectSearch"
      description:
        "The SubjectSearch API returns all subjects that have a specific action (relation) on a given resource. "
        "This is useful for answering questions like \"Who can read this document?\" or \"Who can administer this folder?\"\n\n"
        "Results can be filtered by subject type and support pagination for large result sets.\n\n"
        "## Examples\n"
        "### Find all users who can read a document\n"
        "```json\n"
        "{\n"
        "  \"resource\": {\"type\": \"document\", \"id\": \"roadmap\"},\n"
        "  \"action\": {\"name\": \"can_read\"},\n"
        "  \"subject\": {\"type\": \"user\"}\n"
        "}\n"
        "```\n"
        "Response:\n"
        "```json\n"
        "{\n"
        "  \"subjects\": [\n"
        "    {\"type\": \"user\", \"id\": \"anne\"},\n"
        "    {\"type\": \"user\", \"id\": \"bob\"},\n"
        "    {\"type\": \"user\", \"id\": \"charlie\"}\n"
        "  ],\n"
        "  \"page\": {\"count\": 3}\n"
        "}\n"
        "```\n"
        "### Paginated search with limit\n"
        "```json\n"
        "{\n"
        "  \"resource\": {\"type\": \"folder\", \"id\": \"engineering\"},\n"
        "  \"action\": {\"name\": \"can_view\"},\n"
        "  \"subject\": {\"type\": \"user\"},\n"
        "  \"page\": {\"limit\": 10}\n"
        "}\n"
        "```\n"
        "### Continue from previous page\n"
        "```json\n"
        "{\n"
        "  \"resource\": {\"type\": \"folder\", \"id\": \"engineering\"},\n"
        "  \"action\": {\"name\": \"can_view\"},\n"
        "  \"subject\": {\"type\": \"user\"},\n"
        "  \"page\": {\"token\": \"eyJsYXN0X2lkIjoiMTAwIn0=\", \"limit\": 10}\n"
        "}\n"
        "```\n"
    };
  }

  // ResourceSearch returns resources that a subject has access to
  rpc ResourceSearch(ResourceSearchRequest) returns (ResourceSearchResponse) {
    option (google.api.http) = {
      post: "/stores/{store_id}/access/v1/search/resource"
      body: "*"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Search for resources a subject has access to"
      tags: ["AuthZen"]
      operation_id: "ResourceSearch"
      description:
        "The ResourceSearch API returns all resources of a given type that a subject has a specific action (relation) on. "
        "This is useful for answering questions like \"What documents can Anne read?\" or \"What folders can Bob administer?\"\n\n"
        "The resource type filter is required. Results support pagination for large result sets.\n\n"
        "## Examples\n"
        "### Find all documents a user can read\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"anne\"},\n"
        "  \"action\": {\"name\": \"can_read\"},\n"
        "  \"resource\": {\"type\": \"document\"}\n"
        "}\n"
        "```\n"
        "Response:\n"
        "```json\n"
        "{\n"
        "  \"resources\": [\n"
        "    {\"type\": \"document\", \"id\": \"roadmap\"},\n"
        "    {\"type\": \"document\", \"id\": \"budget-2024\"},\n"
        "    {\"type\": \"document\", \"id\": \"team-roster\"}\n"
        "  ],\n"
        "  \"page\": {\"count\": 3}\n"
        "}\n"
        "```\n"
        "### Find folders a user can administer with pagination\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"bob\"},\n"
        "  \"action\": {\"name\": \"can_admin\"},\n"
        "  \"resource\": {\"type\": \"folder\"},\n"
        "  \"page\": {\"limit\": 25}\n"
        "}\n"
        "```\n"
        "### Search with ABAC context\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"anne\"},\n"
        "  \"action\": {\"name\": \"can_read\"},\n"
        "  \"resource\": {\"type\": \"document\"},\n"
        "  \"context\": {\n"
        "    \"current_time\": \"2024-01-15T10:00:00Z\",\n"
        "    \"ip_address\": \"192.168.1.100\"\n"
        "  }\n"
        "}\n"
        "```\n"
    };
  }

  // ActionSearch returns actions a subject can perform on a resource
  rpc ActionSearch(ActionSearchRequest) returns (ActionSearchResponse) {
    option (google.api.http) = {
      post: "/stores/{store_id}/access/v1/search/action"
      body: "*"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Search for actions a subject can perform on a resource"
      tags: ["AuthZen"]
      operation_id: "ActionSearch"
      description:
        "The ActionSearch API returns all actions (relations) that a subject can perform on a specific resource. "
        "This is useful for answering questions like \"What can Anne do with this document?\" or building dynamic UIs "
        "that show only the actions a user is permitted to perform.\n\n"
        "## Examples\n"
        "### Find all actions a user can perform on a document\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"anne\"},\n"
        "  \"resource\": {\"type\": \"document\", \"id\": \"roadmap\"}\n"
        "}\n"
        "```\n"
        "Response:\n"
        "```json\n"
        "{\n"
        "  \"actions\": [\n"
        "    {\"name\": \"can_read\"},\n"
        "    {\"name\": \"can_write\"},\n"
        "    {\"name\": \"can_share\"}\n"
        "  ],\n"
        "  \"page\": {\"count\": 3}\n"
        "}\n"
        "```\n"
        "### Search with ABAC context for time-based permissions\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"bob\"},\n"
        "  \"resource\": {\"type\": \"report\", \"id\": \"quarterly-financials\"},\n"
        "  \"context\": {\n"
        "    \"current_time\": \"2024-01-15T14:30:00Z\",\n"
        "    \"user_department\": \"finance\"\n"
        "  }\n"
        "}\n"
        "```\n"
        "### Paginated action search\n"
        "```json\n"
        "{\n"
        "  \"subject\": {\"type\": \"user\", \"id\": \"admin\"},\n"
        "  \"resource\": {\"type\": \"system\", \"id\": \"production\"},\n"
        "  \"page\": {\"limit\": 50}\n"
        "}\n"
        "```\n"
    };
  }

  // GetConfiguration returns PDP metadata and capabilities per AuthZEN spec section 13
  rpc GetConfiguration(GetConfigurationRequest) returns (GetConfigurationResponse) {
    option (google.api.http) = {get: "/.well-known/authzen-configuration/{store_id}"};
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Get AuthZEN PDP configuration and capabilities"
      tags: ["AuthZen"]
      operation_id: "GetConfiguration"
      description:
        "The GetConfiguration API returns metadata about the Policy Decision Point (PDP) including its name, version, "
        "supported endpoints, and capabilities. This endpoint follows the AuthZEN specification section 13 for PDP discovery.\n\n"
        "Following the AuthZEN spec's multi-tenant pattern, OpenFGA provides a per-store discovery endpoint at "
        "`/.well-known/authzen-configuration/{store_id}`. This returns absolute endpoint URLs specific to that store.\n\n"
        "## Example Response\n"
        "```json\n"
        "{\n"
        "  \"policy_decision_point\": {\n"
        "    \"name\": \"OpenFGA\",\n"
        "    \"version\": \"1.8.0\",\n"
        "    \"description\": \"OpenFGA is a high-performance authorization system\"\n"
        "  },\n"
        "  \"access_endpoints\": {\n"
        "    \"evaluation\": \"/stores/01ARZ3NDEKTSV4RRFFQ69G5FAV/access/v1/evaluation\",\n"
        "    \"evaluations\": \"/stores/01ARZ3NDEKTSV4RRFFQ69G5FAV/access/v1/evaluations\",\n"
        "    \"subject_search\": \"/stores/01ARZ3NDEKTSV4RRFFQ69G5FAV/access/v1/search/subject\",\n"
        "    \"resource_search\": \"/stores/01ARZ3NDEKTSV4RRFFQ69G5FAV/access/v1/search/resource\",\n"
        "    \"action_search\": \"/stores/01ARZ3NDEKTSV4RRFFQ69G5FAV/access/v1/search/action\"\n"
        "  },\n"
        "  \"capabilities\": [\n"
        "    \"evaluation\",\n"
        "    \"evaluations\",\n"
        "    \"subject_search\",\n"
        "    \"resource_search\",\n"
        "    \"action_search\"\n"
        "  ]\n"
        "}\n"
        "```\n"
    };
  }
}

message EvaluationRequest {
  Subject subject = 1 [
    (validate.rules).message.required = true,
    (google.api.field_behavior) = REQUIRED
  ];

  Resource resource = 2 [
    (validate.rules).message.required = true,
    (google.api.field_behavior) = REQUIRED
  ];

  Action action = 3 [
    (validate.rules).message.required = true,
    (google.api.field_behavior) = REQUIRED
  ];

  google.protobuf.Struct context = 4;

  string store_id = 5 [
    json_name = "store_id",
    (validate.rules).string = {
      pattern: "^[ABCDEFGHJKMNPQRSTVWXYZ0-9]{26}$"
      ignore_empty: true
    },
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {example: "\"01G5JAVJ41T49E9TT3SKVS7X1J\""}
  ];

  // authorization_model_id removed - use Openfga-Authorization-Model-Id header instead
  reserved 6;
  reserved "authorization_model_id";
}

message EvaluationsItemRequest {
  optional Subject subject = 1;
  optional Resource resource = 2;
  optional Action action = 3;
  optional google.protobuf.Struct context = 4;
}

message Subject {
  string type = 1 [
    (validate.rules).string = {
      pattern: "^[^:#@\\s]{1,50}$"
      ignore_empty: false
    },
    (google.api.field_behavior) = REQUIRED,
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {example: "\"user\""}
  ];

  string id = 2 [
    (validate.rules).string = {
      pattern: "^[^:#@\\s]{1,500}$"
      ignore_empty: false
    },
    (google.api.field_behavior) = REQUIRED,
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {example: "\"anne\""}
  ];

  optional google.protobuf.Struct properties = 3;
}

// SubjectFilter is used for search operations where id is optional
message SubjectFilter {
  string type = 1 [
    (validate.rules).string = {
      pattern: "^[^:#@\\s]{1,50}$"
      ignore_empty: false
    },
    (google.api.field_behavior) = REQUIRED,
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {example: "\"user\""}
  ];

  // Optional subject id filter
  optional string id = 2 [
    (validate.rules).string = {
      pattern: "^[^:#@\\s]{1,500}$"
      ignore_empty: true
    },
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {example: "\"anne\""}
  ];

  optional google.protobuf.Struct properties = 3;
}

message Resource {
  string type = 1 [
    (validate.rules).string = {
      pattern: "^[^:#@\\s]{1,50}$"
      ignore_empty: false
    },
    (google.api.field_behavior) = REQUIRED,
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {example: "\"document\""}
  ];

  string id = 2 [
    (google.api.field_behavior) = REQUIRED,
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {example: "\"roadmap\""}
  ];

  optional google.protobuf.Struct properties = 3;
}

message Action {
  string name = 1 [
    (validate.rules).string = {
      pattern: "^[^:#@\\s]{1,50}$"
      ignore_empty: false
    },
    (google.api.field_behavior) = REQUIRED,
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {example: "\"can_read\""}
  ];

  optional google.protobuf.Struct properties = 3;
}

message EvaluationResponse {
  bool decision = 1;

  optional EvaluationResponseContext context = 2;
}

message EvaluationResponseContext {
  optional string id = 1;

  optional google.protobuf.Struct reason_admin = 2;

  optional google.protobuf.Struct reason_user = 3;

  optional ResponseContextError error = 4;
}

message EvaluationsRequest {
  optional Subject subject = 1;
  optional Action action = 2;
  optional Resource resource = 3;
  optional google.protobuf.Struct context = 4;
  repeated EvaluationsItemRequest evaluations = 5;

  string store_id = 6 [
    json_name = "store_id",
    (validate.rules).string = {
      pattern: "^[ABCDEFGHJKMNPQRSTVWXYZ0-9]{26}$"
      ignore_empty: true
    },
    (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {example: "\"01G5JAVJ41T49E9TT3SKVS7X1J\""}
  ];

  // Options for batch evaluation semantics
  EvaluationsOptions options = 7;
}

message EvaluationsResponse {
  repeated EvaluationResponse evaluation_responses = 1 [json_name = "evaluations"];
}

// Options for batch evaluations
message EvaluationsOptions {
  // Controls how batch evaluations are processed
  EvaluationsSemantic evaluations_semantic = 1 [json_name = "evaluations_semantic"];
}

// Enum for evaluation semantics
// buf:lint:ignore ENUM_ZERO_VALUE_SUFFIX
// buf:lint:ignore ENUM_VALUE_PREFIX
// buf:lint:ignore ENUM_VALUE_UPPER_SNAKE_CASE
enum EvaluationsSemantic {
  // Execute all evaluations (default behavior)
  execute_all = 0;
  // Stop on first deny decision
  deny_on_first_deny = 1;
  // Stop on first permit decision
  permit_on_first_permit = 2;
}

message ResponseContextError {
  uint32 status = 1;
  string message = 2;
}

// Pagination request parameters for search operations
message PageRequest {
  // Continuation token from previous response
  optional string token = 1;
  // Maximum number of results to return (default: 50, max: 1000)
  optional uint32 limit = 2 [(validate.rules).uint32 = {lte: 1000}];
}

// Pagination response parameters
message PageResponse {
  // Token to retrieve next page (empty if no more results)
  string next_token = 1 [json_name = "next_token"];
  // Number of results in this page
  uint32 count = 2;
  // Total number of results (if known, otherwise 0)
  optional uint32 total = 3;
}

// SubjectSearch request
message SubjectSearchRequest {
  Resource resource = 1 [
    (validate.rules).message.required = true,
    (google.api.field_behavior) = REQUIRED
  ];

  Action action = 2 [
    (validate.rules).message.required = true,
    (google.api.field_behavior) = REQUIRED
  ];

  // Optional filter by subject type (id is optional in filter)
  optional SubjectFilter subject = 3;

  google.protobuf.Struct context = 4;

  PageRequest page = 5;

  string store_id = 6 [
    json_name = "store_id",
    (validate.rules).string = {
      pattern: "^[ABCDEFGHJKMNPQRSTVWXYZ0-9]{26}$"
      ignore_empty: true
    }
  ];

  // authorization_model_id removed - use Openfga-Authorization-Model-Id header instead
  reserved 7;
  reserved "authorization_model_id";
}

message SubjectSearchResponse {
  repeated Subject subjects = 1;
  PageResponse page = 2;
}

// ResourceSearch request
message ResourceSearchRequest {
  Subject subject = 1 [
    (validate.rules).message.required = true,
    (google.api.field_behavior) = REQUIRED
  ];

  Action action = 2 [
    (validate.rules).message.required = true,
    (google.api.field_behavior) = REQUIRED
  ];

  // Optional filter by resource type
  optional Resource resource = 3;

  google.protobuf.Struct context = 4;

  PageRequest page = 5;

  string store_id = 6 [
    json_name = "store_id",
    (validate.rules).string = {
      pattern: "^[ABCDEFGHJKMNPQRSTVWXYZ0-9]{26}$"
      ignore_empty: true
    }
  ];

  // authorization_model_id removed - use Openfga-Authorization-Model-Id header instead
  reserved 7;
  reserved "authorization_model_id";
}

message ResourceSearchResponse {
  repeated Resource resources = 1;
  PageResponse page = 2;
}

// ActionSearch request
message ActionSearchRequest {
  Subject subject = 1 [
    (validate.rules).message.required = true,
    (google.api.field_behavior) = REQUIRED
  ];

  Resource resource = 2 [
    (validate.rules).message.required = true,
    (google.api.field_behavior) = REQUIRED
  ];

  google.protobuf.Struct context = 3;

  PageRequest page = 4;

  string store_id = 5 [
    json_name = "store_id",
    (validate.rules).string = {
      pattern: "^[ABCDEFGHJKMNPQRSTVWXYZ0-9]{26}$"
      ignore_empty: true
    }
  ];

  // authorization_model_id removed - use Openfga-Authorization-Model-Id header instead
  reserved 6;
  reserved "authorization_model_id";
}

message ActionSearchResponse {
  repeated Action actions = 1;
  PageResponse page = 2;
}

// GetConfiguration request
message GetConfigurationRequest {
  // The store ID for which to retrieve configuration.
  // Following the AuthZEN spec's multi-tenant pattern, each store has its own discovery endpoint.
  string store_id = 1;
}

// GetConfiguration response - PDP metadata per AuthZEN spec section 13
message GetConfigurationResponse {
  PolicyDecisionPoint policy_decision_point = 1 [json_name = "policy_decision_point"];
  Endpoints access_endpoints = 2 [json_name = "access_endpoints"];
  repeated string capabilities = 3;
}

message PolicyDecisionPoint {
  string name = 1;
  string version = 2;
  string description = 3;
}

message Endpoints {
  string evaluation = 1;
  string evaluations = 2;
  string subject_search = 3 [json_name = "subject_search"];
  string resource_search = 4 [json_name = "resource_search"];
  string action_search = 5 [json_name = "action_search"];
}
